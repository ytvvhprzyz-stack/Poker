<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Poker Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:#f2f2f7;
  margin:0;
  padding:15px;
}
h1,h2{text-align:center;margin:10px 0;}
.card{
  background:#fff;
  border-radius:14px;
  padding:15px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
}
.player-row{
  display:flex;
  align-items:center;
  margin-bottom:10px;
}
.player-row img{
  width:36px;
  height:36px;
  border-radius:50%;
  margin-right:10px;
}
.player-row span{
  flex:1;
  font-weight:600;
}
.player-row input{
  width:70px;
  padding:6px;
  font-size:16px;
  text-align:right;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#007aff;
  color:#fff;
  font-size:16px;
  font-weight:600;
}
button.danger{background:#ff3b30}
table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th,td{
  padding:8px;
  border-bottom:1px solid #ddd;
  text-align:center;
}
.valueZero{opacity:0.35;}
.valuePositive{color:#22c55e;font-weight:700;}
.valueNegative{color:#ef4444;font-weight:700;}
.badge{
  background:#facc15;
  color:#000;
  padding:2px 6px;
  border-radius:6px;
  font-size:11px;
  margin-left:4px;
}
.actions button{
  width:auto;
  padding:5px 8px;
  font-size:12px;
  margin:2px;
}
.player-img-small{
  width:22px;
  height:22px;
  border-radius:50%;
  vertical-align:middle;
  margin-right:6px;
}
</style>
</head>

<body>

<h1>‚ô†Ô∏è Poker Tracker</h1>

<div class="card">
<h2>Inserisci / Modifica partita</h2>
<div id="inputs"></div>
<button onclick="saveMatch()">Salva partita</button>
</div>

<div class="card">
<h2>Partite registrate</h2>
<table id="matchesTable"></table>
</div>

<div class="card">
<h2>Classifica totale</h2>
<table id="ranking"></table>
</div>

<div class="card">
<h2>Andamento saldo cumulativo</h2>
<canvas id="chart"></canvas>
</div>

<script>
const players=[
{name:"Chirurgo",avatar:"https://raw.githubusercontent.com/ytvvhprzyz-stack/Poker/main/chirurgo.jpg"},
{name:"Professore",avatar:"https://raw.githubusercontent.com/ytvvhprzyz-stack/Poker/main/professore.jpg"},
{name:"Barellista",avatar:"https://raw.githubusercontent.com/ytvvhprzyz-stack/Poker/main/barellista.jpg"},
{name:"Anestesista",avatar:"https://raw.githubusercontent.com/ytvvhprzyz-stack/Poker/main/anestesista.jpg"},
{name:"Radiografo",avatar:"https://raw.githubusercontent.com/ytvvhprzyz-stack/Poker/main/radiografo.jpg"},
{name:"Caposala",avatar:"https://raw.githubusercontent.com/ytvvhprzyz-stack/Poker/main/caposala.jpg"}
];

let matches=JSON.parse(localStorage.getItem("matches")||"[]");
let editIndex=null;
let chart;

const inputs=document.getElementById("inputs");
players.forEach(p=>{
inputs.innerHTML+=`
<div class="player-row">
<img src="${p.avatar}">
<span>${p.name}</span>
<input type="number" id="${p.name}" value="0">
</div>`;
});

function saveMatch(){
let match={date:new Date().toLocaleString(),results:{}};
let sum=0;
players.forEach(p=>{
let v=parseInt(document.getElementById(p.name).value)||0;
match.results[p.name]=v;
sum+=v;
});
if(sum!==0){alert("La somma deve essere 0");return;}
if(editIndex!==null){
matches[editIndex]=match;
editIndex=null;
}else{
matches.push(match);
}
localStorage.setItem("matches",JSON.stringify(matches));
renderAll();
players.forEach(p=>document.getElementById(p.name).value=0);
}

function renderAll(){
renderTable();
renderRanking();
renderChart();
}

function renderTable(){
const t=document.getElementById("matchesTable");
let h="<tr><th>Data</th>";
players.forEach(p=>h+=`<th>${p.name}</th>`);
h+="<th>Azioni</th></tr>";
matches.forEach((m,i)=>{
let max=Math.max(...Object.values(m.results));
h+=`<tr><td>${m.date}</td>`;
players.forEach(p=>{
let val=m.results[p.name];
let cls=val===0?"valueZero":(val>0?"valuePositive":"valueNegative");
let badge=(val===max && max>0) ? `<span class="badge">üèÜ</span>` : "";
h+=`<td class="${cls}">${val}${badge}</td>`;
});
h+=`<td class="actions">
<button onclick="editMatch(${i})">‚úèÔ∏è</button>
<button class="danger" onclick="deleteMatch(${i})">üóëÔ∏è</button>
</td></tr>`;
});
t.innerHTML=h;
}

function editMatch(i){
editIndex=i;
players.forEach(p=>{
document.getElementById(p.name).value=matches[i].results[p.name];
});
window.scrollTo({top:0,behavior:"smooth"});
}

function deleteMatch(i){
if(confirm("Eliminare la partita?")){
matches.splice(i,1);
localStorage.setItem("matches",JSON.stringify(matches));
renderAll();
}
}

function renderRanking(){
let totals={};
players.forEach(p=>totals[p.name]=0);
matches.forEach(m=>{
players.forEach(p=>totals[p.name]+=m.results[p.name]);
});
let r=Object.entries(totals).sort((a,b)=>b[1]-a[1]);
let h="<tr><th>Giocatore</th><th>Saldo</th></tr>";
r.forEach(e=>{
let pl=players.find(p=>p.name===e[0]);
h+=`<tr class="${e[1]>0?'win':''}">
<td><img src="${pl.avatar}" class="player-img-small">${e[0]}</td>
<td>${e[1]}</td></tr>`;
});
ranking.innerHTML=h;
}

function renderChart(){
let labels=matches.map((_,i)=>"P"+(i+1));
let datasets=players.map(p=>{
let sum=0;
return{
label:p.name,
data:matches.map(m=>{
sum+=m.results[p.name];
return sum;
}),
borderWidth:2
};
});
if(chart) chart.destroy();
chart=new Chart(document.getElementById("chart"),{
type:"line",
data:{labels,datasets},
options:{
responsive:true,
plugins:{legend:{position:"bottom"}},
scales:{y:{beginAtZero:true}}
}
});
}

renderAll();
</script>
</body>
</html>
