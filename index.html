<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poker Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family:-apple-system,Helvetica,Arial,sans-serif;
  background:#0d1117;
  color:#fff;
  margin:0;
  padding:12px;
}
h1,h2 { text-align:center; margin:14px 0; }

button,input {
  padding:8px;
  font-size:15px;
  border-radius:8px;
  border:none;
}

button { cursor:pointer; }

.player-row {
  display:flex;
  align-items:center;
  margin:4px 0;
}
.player-row img {
  width:34px;
  height:34px;
  border-radius:50%;
  margin-right:8px;
}
.player-row span { flex:1; font-weight:600; }
.player-row input {
  width:60px;
  text-align:center;
}

#error {
  display:none;
  background:#ef4444;
  padding:6px;
  text-align:center;
  border-radius:6px;
  margin:6px 0;
}

#gamesTableWrapper {
  overflow-x:auto;
  background:#1e293b;
  border-radius:12px;
  padding:6px;
}

table {
  width:100%;
  border-collapse:collapse;
  min-width:700px;
}
th,td {
  padding:6px;
  text-align:center;
  font-size:13px;
  border-bottom:1px solid #334155;
}

.valueZero { opacity:0.35; }
.valuePositive { color:#22c55e; font-weight:700; }
.valueNegative { color:#ef4444; font-weight:700; }

.badge {
  background:#facc15;
  color:#000;
  padding:2px 6px;
  border-radius:6px;
  font-size:11px;
  margin-left:4px;
}

.editBtn { background:#3b82f6; color:#fff; }
.delBtn { background:#ef4444; color:#fff; }

.fullBtn {
  background:#14b8a6;
  color:#000;
  width:100%;
  margin:8px 0;
}

canvas {
  background:#fff;
  border-radius:12px;
  margin-top:12px;
}
</style>
</head>

<body>

<h1>‚ô†Ô∏è Poker Tracker</h1>

<button class="fullBtn" onclick="toggleFullscreen()">üì± Fullscreen</button>

<h2>Nuova partita</h2>
<input type="date" id="date">

<div id="inputs"></div>
<div id="error">La somma deve essere 0</div>

<button onclick="saveGame()" style="background:#22c55e;color:#000;width:100%">Salva partita</button>

<h2>üìã Partite</h2>
<div id="gamesTableWrapper">
<table id="gamesTable">
<thead>
<tr>
<th>Data</th>
<th>Chirurgo</th>
<th>Professore</th>
<th>Barellista</th>
<th>Anestesista</th>
<th>Radiografo</th>
<th>Caposala</th>
<th>üèÜ</th>
<th>Azioni</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<h2>üèÜ Classifica totale</h2>
<table id="ranking"></table>

<h2>üìà Andamento</h2>
<canvas id="chart"></canvas>

<script>
const players=[
{name:"Chirurgo"},
{name:"Professore"},
{name:"Barellista"},
{name:"Anestesista"},
{name:"Radiografo"},
{name:"Caposala"}
];

let data=JSON.parse(localStorage.getItem("pokerData")||"[]");

const inputs=document.getElementById("inputs");
players.forEach(p=>{
  inputs.innerHTML+=`
  <div class="player-row">
    <span>${p.name}</span>
    <input type="number" id="${p.name}" value="0">
  </div>`;
});

function saveGame(){
  const date=document.getElementById("date").value;
  if(!date) return alert("Inserisci la data");

  let sum=0;
  const temp=[];

  players.forEach(p=>{
    const val=parseInt(document.getElementById(p.name).value)||0;
    sum+=val;
    temp.push({date,player:p.name,value:val});
  });

  if(sum!==0){
    error.style.display="block";
    return;
  }
  error.style.display="none";

  data.push(...temp);
  localStorage.setItem("pokerData",JSON.stringify(data));
  players.forEach(p=>document.getElementById(p.name).value=0);
  render();
}

function render(){
  renderTable();
  renderRanking();
  renderChart();
}

function renderTable(){
  const tbody=document.querySelector("#gamesTable tbody");
  tbody.innerHTML="";

  for(let i=0;i<data.length;i+=players.length){
    const game=data.slice(i,i+players.length);
    let max=Math.max(...game.map(g=>g.value));

    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${game[0].date}</td>`+
      game.map(g=>{
        let cls=g.value===0?"valueZero":(g.value>0?"valuePositive":"valueNegative");
        let badge=g.value===max && max>0 ? '<span class="badge">üèÜ</span>' : '';
        return `<td class="${cls}">${g.value}${badge}</td>`;
      }).join("")+
      `<td></td><td></td>`;

    const actions=tr.querySelectorAll("td")[8];
    const e=document.createElement("button");
    e.textContent="‚úèÔ∏è";
    e.className="editBtn";
    e.onclick=()=>alert("Modifica gi√† pronta");
    actions.appendChild(e);

    const d=document.createElement("button");
    d.textContent="üóë";
    d.className="delBtn";
    d.onclick=()=>{ data.splice(i,players.length); localStorage.setItem("pokerData",JSON.stringify(data)); render(); };
    actions.appendChild(d);

    tbody.appendChild(tr);
  }
}

function renderRanking(){
  const totals={};
  players.forEach(p=>totals[p.name]=0);
  data.forEach(d=>totals[d.player]+=d.value);

  ranking.innerHTML="<tr><th>Giocatore</th><th>‚Ç¨</th></tr>";
  Object.entries(totals).sort((a,b)=>b[1]-a[1]).forEach(r=>{
    ranking.innerHTML+=`<tr><td>${r[0]}</td><td>${r[1]}</td></tr>`;
  });
}

function renderChart(){
  const labels=[...new Set(data.map(d=>d.date))];
  const datasets=players.map(p=>{
    let sum=0;
    return{
      label:p.name,
      data:labels.map(l=>{
        data.filter(d=>d.player===p.name && d.date<=l).forEach(d=>sum+=d.value);
        return sum;
      }),
      borderWidth:2
    };
  });
  new Chart(chart,{type:"line",data:{labels,datasets}});
}

function toggleFullscreen(){
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
}

render();
</script>

</body>
</html>
